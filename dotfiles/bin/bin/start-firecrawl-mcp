#!/bin/bash

# Check for 1Password CLI
if ! command -v op &> /dev/null; then
    echo "Error: 1Password CLI (op) is not installed or not in PATH." >&2
    exit 1
fi

# Retrieve the API key from 1Password
# Vault: Personal
# Item: FIRECRAWL_API_KEY
# Field: credential
API_KEY=$(op read "op://Personal/FIRECRAWL_API_KEY/credential")

if [ -z "$API_KEY" ]; then
    echo "Error: Failed to retrieve FIRECRAWL_API_KEY from 1Password." >&2
    exit 1
fi

# Stop any existing container with the same name
docker rm -f firecrawl-mcp-server &>/dev/null || true

HOST_PORT=3015

docker rm -f firecrawl-mcp-server &>/dev/null || true

echo "Starting Firecrawl MCP Server (SSE mode) on localhost:$HOST_PORT..."

docker run -d \
  --name firecrawl-mcp-server \
  --restart unless-stopped \
  -p "$HOST_PORT:3015" \
  -e FIRECRAWL_API_KEY="$API_KEY" \
  -e PORT=3015 \
  -e HOST=0.0.0.0 \
  -e HTTP_STREAMABLE_SERVER=true \
  mcp/firecrawl